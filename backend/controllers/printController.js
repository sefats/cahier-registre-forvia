const axios = require("axios");

exports.generateAndPrintZPL = async (req, res) => {
  const {
    name,
    firstname,
    email,
    phone,
    entreprise,
    contactPerson,
    startTime,
    endTime,
  } = req.body;

  const zpl = `
        ^XA
        ^FO50,50^GFA,4708,4708,44,,:::gG07IFE,07RF8K0MFM03OFCI01IFO03IF01FF8M03FFE,1SFCJ07MFEL07PFC001IF8N03IF03FFCM0JF,1SFCI03OFCK0RF800IFCN07FFE03FFCM0JF8,1SFCI0QFK0RFC00IFCN07FFE07FFCL01JF8,1SFC001QF8J0SF007FFEN0IFC07FFCL01JFC,1SFC007QFEJ0SF807FFEN0IF807FFCL03JFC,1SFC00SFJ0SFC03FFEM01IF807FFCL07JFE,1SFC01SF8I0SFC03IFM01IF007FFCL07JFE,1SFC03SFCI0SFE01IFM03IF007FFCL07KF,1SFC07JFCI03JFEI0SFE01IF8L03FFE007FFCL0LF,1SFC0JFEK03IFEI0TF00IF8L07FFE007FFCL0LF8,1FFER0JF8L0JFI0IF8L0JF00IFCL07FFC007FFCK01LF8,1FFEQ01IFEM07IF800IF8L03IF007FFCL0IFC007FFCK01FFE7FFC,1IFQ01IFCM03IF800IF8L01IF007FFEL0IF8007FFCK03FFE7FFC,1IFEP03IF8M01IFC00IF8M0IF003FFEK01IF8007FFCK03FFE3FFE,1LFCM03IFO0IFC00IF8M0IF003IFK01IFI07FFCK07FFC1IF,1OFCJ07FFEO07FFC00IF8M0IF001IFK03IFI07FFCK0IFC1IF,1PFCI07FFEO07FFE00IF8I0JFCL01IF03FFEK07FFCK0IF80IF8,1QFI07FFCO03FFE00IF8M0IF001IF8J03FFEI07FFCK0IF80IF8,1QF8007FFCO03FFE00IF8L01IF007FFCJ01IFCJ07FFCJ01IF007FFC,0QFC007FFCO03FFE00IF8L03IFI07FFCJ0IFCI07FFCJ03IF007FFC,07PFC00IF8O01FFE00IF8L07IFI03FFEJ0IF8I07FFCJ03FFE003FFE,00PFC00IF8O01FFE00IF8K03IFEI03FFEI01IF8I07FFCJ07FFE003FFE,L0LFC00IF8O01FFE00SFEI01IFI01IFJ07FFCJ07FFC003IF,O03FFE00IF8O01IF00SFCI01IFI03IFJ07FFCJ0IFC001IF,O03FFE00IF8O01FFE00SF8J0IF8003FFEJ07FFCJ0IF8001IF8,N03IFC00IF8O01FFE00SF8J0IF8007FFEJ07FFCI01IF8I0IF8,J07MFC00IF8O01FFE00SFK07FFC007FFCJ07FFCI01IFJ0IFC,03PFC007FF8O01FFE00RFCK07FFC00IFCJ07FFCI03IFJ07FFC,0QF8007FFCO03FFE00RF8K03FFE00IF8J07FFCI03FFEJ07FFE,0QF8007FFCO03FFE00QFEL03FFE01IFK07FFCI07FFEJ03FFE,1QFI07FFCO03FFE00QFCL01IF01IFK07FFCI07QF,1PFEI07FFEO07FFE00IF8I0JFCL01IF03FFEK07FFCI0RF,1OFCJ03FFEO07FFC00IF8I01IFEM0IF83FFEK07FFCI0RF8,1LFCM03IFO0IFC00IF8J0JFM0IF87FFCK07FFC001RF8,1IFEP03IF8M01IF800IF8J07IF8L07FFC7FFCK07FFC001RFC,1IFQ01IFCM03IF800IF8J03IF8L07FFCIF8K07FFC003RFC,1FFEQ01JFM07IFI0IF8J01IFCL03FFEIF8K07FFC003RFE,1FFER0JF8K01JFI0IF8K0IFEL03LFL07FFC007RFE,1FFER07JFK07IFEI0IF8K07IFL01LFL07FFC00TF,1FFER07KFI0KFCI0IF8K07IF8K01KFEL07FFC00IFCL01IF8,1FFER03SFCI0IF8K03IF8L0KFEL07FFC01IF8L01IF8,1FFES0RFEJ0IF8L0IFEL07JFCL07FFC03IFN0IFC,1FFES03QFCJ0IF8L07IFL03JF8L07FFC03IFN07FFE,1FFES01QF8J0IF8L03IFL03JF8L07FFC07FFEN07FFE,1FFET07OFEK0IF8L01IF8K01JFM07FFC07FFEN03IF,1FFET01OF8K0IF8M0IFCK01JFM07FFC0IFCO0IF,1FFEU03MFCL0IFN0IFEL0IFEM07FFC0IFCO07FF8g03KFCgG02W01g08gH0IF,,::::::::::::::hJ0FFC,hI03FFCgQ036,hI07FFCgQ03F,hI0IFCgQ03F,:hH01FEgS03F,hH01FCgS03F,hH01F8,hH01F,::h07C1IFC00FF1F01F001FI07F003FEJ07F803FI0FF1F,h07C1IFC03FFDF01F803F003FF00IF8003IF03F003FFDF,h07C1IFC0KF01F803F007FF01IFC007IF03F007JF,h07C1IFC0KF01F803F00IF03IFE00JF03F00KF,h07C1IFC1KF01F803F01IF07IFE01IFE03F01KF,h07C1IFC3FC0FF01F803F01FF007E07F01FE0E03F03FC0FF,hH01FI03F807F01F803F01FC00FC03F03F8I03F03F807F,hH01FI03F003F01F803F01F800F807F03FJ03F03F003F,hH01FI07E003F01F803F03FI0F81FF83FJ03F07E001F,hH01FI07E001F01F803F03FI0F8IF87EJ03F07E001F,hH01FI07E001F01F803F03FI0F8IF87EJ03F07E001F,hH01FI07E001F01F803F03FI0F8IF87EJ03F07E001F,hH01FI07E003F01F803F03FI0F81FF87EJ03F07E003F,hH01FI03F003F01F803F01F800F807F03FJ03F03F003F,hH01FI03F807F01F803F01FC00FC03F03F8I03F03F807F,h07C1IFC0FF01F803F01FF007E07F01FE0E03F03FC0FF,h07C1IFC3FC1FF01F803F01IFE01IFE03F01KF,h07C1IFC1KFE01F803F00IFE00IFE03F00LF,h07C1IFC0KF01F803F007FF01IF803F007FFL03F00KF,h07C1IFC0KF01F803F003FF00IF8003IF03F007JF,h07C1IFC07FFDF01F003F001FI07F003FEJ07F803FI0FF1F,h07C1IFC00FF1F01F001FI07F003FEI07F803FJ0FF1F,,::::::::::::::hI03FFC,hI07FFC,hH0IFCgR03F,:hH01FCgS03F,hH01F8,hH01F,hH01E,:hH07FC000FFC0FF,hH0MF07FC3FFDF,hH03LF03FF,h07KFE00KF,h0MF003KF8,07KF003FFL0FF80LF,0FF00IF8K07FF8007FF003FFL03FFE07IF,,::^FS
        ^FO50,300^A0N50,50^FD${name}^FS
        ^FO50,400^A0N50,50^FD${firstname}^FS
        ^FO50,500^A0N50,50^FD${email}^FS
        ^FO50,600^A0N50,50^FD${phone}^FS
        ^FO50,700^A0N50,50^FD${entreprise}^FS
        ^FO50,800^A0N50,50^FD${contactPerson}^FS
        ^FO50,900^A0N50,50^FD${new Date(startTime).toLocaleString()}^FS
        ^FO50,1000^A0N50,50^FD${new Date(endTime).toLocaleString()}^FS
        ^XZ
    `;

  try {
    const response = await axios.post("http://10.60.202.25", zpl, {
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
    });

    if (response.status === 200) {
      console.log("Impression réussie");
      res.json({ message: "Impression réussie" });
    } else {
      console.error("Erreur lors de l'impression :", response.statusText);
      res
        .status(500)
        .json({
          error: "Erreur lors de l'impression",
          details: response.statusText,
        });
    }
  } catch (err) {
    console.error("Erreur lors de l'envoi de la commande ZPL :", err);
    res
      .status(500)
      .json({
        error: "Erreur lors de l'envoi de la commande ZPL",
        details: err,
      });
  }
};
